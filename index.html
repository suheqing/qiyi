<html lang="zh-CN">
<head>
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="yes" name="apple-touch-fullscreen">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="320" name="MobileOptimized">
    <title>安全入口跳转中</title>
    <style>
        /* 基础样式重置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #f5f5f5;
            min-height: 100vh;
        }
        
        .loading-container {
            text-align: center;
            padding-top: 40vh;
        }
        
        .loading-title {
            color: #333;
            font-family: "Microsoft YaHei", sans-serif;
            margin-bottom: 20px;
            font-size: 18px;
        }
        
        .container {
            width: 100px;
            height: 100px;
            position: relative;
            margin: 0 auto;
            animation: rotate-move 2s ease-in-out infinite;
        }

        .dot {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            margin: auto;
        }

        .dot-3 {
            background-color: #f74d75;
            animation: dot-3-move 2s ease infinite;
        }

        .dot-2 {
            background-color: #10beae;
            animation: dot-2-move 2s ease infinite;
        }

        .dot-1 {
            background-color: #ffe386;
            animation: dot-1-move 2s ease infinite;
        }

        @keyframes dot-3-move {
            20% { transform: scale(1) }
            45% { transform: translateY(-18px) scale(.45) }
            60% { transform: translateY(-25px) scale(.45) }
            80% { transform: translateY(-25px) scale(.45) }
            100% { transform: translateY(0px) scale(1) }
        }

        @keyframes dot-2-move {
            20% { transform: scale(1) }
            45% { transform: translate(-16px, 12px) scale(.45) }
            60% { transform: translate(-20px, 15px) scale(.45) }
            80% { transform: translate(-20px, 15px) scale(.45) }
            100% { transform: translateY(0px) scale(1) }
        }

        @keyframes dot-1-move {
            20% { transform: scale(1) }
            45% { transform: translate(16px, 12px) scale(.45) }
            60% { transform: translate(20px, 15px) scale(.45) }
            80% { transform: translate(20px, 15px) scale(.45) }
            100% { transform: translateY(0px) scale(1) }
        }

        @keyframes rotate-move {
            55% { transform: rotate(0deg) }
            80% { transform: rotate(360deg) }
            100% { transform: rotate(360deg) }
        }

        .content {
            height: 100%;
            width: 100%;
            position: fixed;
            left: 0;
            top: 0;
            border: none;
            display: none;
        }
        
        .error-message {
            color: #e74c3c;
            font-family: "Microsoft YaHei", sans-serif;
            text-align: center;
            margin-top: 40vh;
            padding: 0 20px;
            display: none;
        }
        
        .redirect-countdown {
            color: #666;
            font-family: "Microsoft YaHei", sans-serif;
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="loading-container">
        <div class="loading-title">安全检测中，请稍候...</div>
        <div class="container">
            <div class="dot dot-1"></div>
            <div class="dot dot-2"></div>
            <div class="dot dot-3"></div>
        </div>
        <div class="redirect-countdown">将在 <span id="countdown">3</span> 秒后自动跳转</div>
    </div>
    
    <div class="error-message" id="errorMessage"></div>
    <iframe class="content" id="targetFrame"></iframe>

    <script>
        // 增强的解密函数，增加简单混淆
        function decodeUrl(encoded) {
            try {
                // 简单的字符替换混淆
                const混淆后 = encoded.replace(/x/g, '+').replace(/y/g, '/').replace(/z/g, '=');
                return atob(混淆后);
            } catch (e) {
                console.error('URL解码失败:', e);
                return null;
            }
        }
        
        // 验证URL是否合法
        function isValidUrl(url) {
            try {
                new URL(url);
                return url.startsWith('http');
            } catch (e) {
                return false;
            }
        }
        
        // 显示错误信息
        function showError(message) {
            document.querySelector('.loading-container').style.display = 'none';
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }
        
        // 解析URL参数并处理iframe加载
        const urlParams = new URLSearchParams(window.location.search);
        const encodedParam = urlParams.get('c');
        let trueurl = encodedParam ? decodeUrl(encodedParam) : null;
        
        // 倒计时功能
        let countdown = 3;
        const countdownEl = document.getElementById('countdown');
        const countdownInterval = setInterval(() => {
            countdown--;
            countdownEl.textContent = countdown;
            if (countdown <= 0) {
                clearInterval(countdownInterval);
            }
        }, 1000);
        
        if (trueurl && isValidUrl(trueurl)) {
            // 3秒后隐藏加载动画并显示iframe
            setTimeout(function() {
                document.querySelector('.loading-container').style.display = "none";
                const iframe = document.getElementById('targetFrame');
                iframe.src = trueurl;
                iframe.style.display = "block";
                console.log('加载URL:', trueurl);
            }, 3000);
        } else {
            clearInterval(countdownInterval);
            showError('无效的链接参数，请检查链接是否正确');
        }

        // 处理鼠标滚轮事件
        const firefox = navigator.userAgent.indexOf('Firefox') != -1;
        
        function handleMouseWheel(e, doc) {
            if (e.preventDefault) {
                e.preventDefault();
            } else {
                e.returnValue = false;
            }
            
            const up = firefox && e.detail < 0 || e.wheelDelta > 0;
            const scrollAmount = up ? -50 : 50;
            
            // 应用滚动
            if (doc.body.scrollTop !== undefined) {
                doc.body.scrollTop += scrollAmount;
            }
            if (doc.documentElement.scrollTop !== undefined) {
                doc.documentElement.scrollTop += scrollAmount;
            }
        }
        
        function bindMouseWheel(ifr) {
            try {
                const doc = ifr.contentWindow.document;
                
                if (firefox) {
                    doc.addEventListener('DOMMouseScroll', function(e) {
                        handleMouseWheel(e, doc);
                    }, false);
                } else {
                    doc.onmousewheel = function(e) {
                        handleMouseWheel(e || ifr.contentWindow.event, doc);
                    };
                }
            } catch (e) {
                console.warn('跨域限制，无法绑定鼠标滚轮事件:', e);
            }
        }
        
        // 为iframe绑定加载事件
        document.getElementById('targetFrame').onload = function() {
            bindMouseWheel(this);
        };
    </script>
</body>
</html>
